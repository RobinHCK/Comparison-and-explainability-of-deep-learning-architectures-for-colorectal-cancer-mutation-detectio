from config import *
import os
import shutil





def create_dataset_hierarchy(dataset_path):
    """Create the dataset hierarchy.
    
    Create a folder patches_QuPatches/ to store the patches (.png) created by QuPath script. For each annotation QuPath creates an image and the associated mask.

    Args:
        dataset_path (str): The dataset path to use.

    Returns:
        None.
        
    Raises:
        OSError: Error while creating the folders.
    """
    try:  
        if not os.path.exists(dataset_path):
            os.mkdir(dataset_path)
        if not os.path.exists(dataset_path + 'patches_QuPath/'):
            os.mkdir(dataset_path + 'patches_QuPath/')

    except OSError:  
        print ('Directory creation failed')

    print ('Directory creation successful')



def move_patches_from_QuPath_to_dataset(wsi_to_move):
    """Move patches generated by QuPath to the dataset.
    
    Copy the patches (1 image & 1 mask per annotation) created by QuPath and paste them into the dataset.
    This process is done for each WSI id given in wsi_to_move.

    Args:
        wsi_to_move (array str): The Id of the WSI to move in the dataset.

    Returns:
        None.
    """
    for wsi in wsi_to_move:
        for patch_QuPath in os.listdir(QuPath_annotations_path + wsi + '/Annotations/'):
            shutil.copyfile(QuPath_annotations_path + wsi + '/Annotations/' + patch_QuPath, dataset_path + 'patches_QuPath/' + patch_QuPath)

        print ('WSI ' + wsi + ' successfully moved')
    print ('Patches from QuPath successfully moved')





if __name__ == '__main__':
    # Create hierarchy
    create_dataset_hierarchy(dataset_path)

    # Move patches generated by QuPath to the dataset
    move_patches_from_QuPath_to_dataset(WT + G12C + others)